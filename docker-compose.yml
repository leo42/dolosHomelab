services:
  dolos-mainnet:
    image: ${DOLOS_IMAGE:-ghcr.io/txpipe/dolos:latest}
    container_name: dolos-mainnet
    volumes:
      - ./config/mainnet:/etc/dolos:ro
      - ./data/mainnet:/data
    ports:
      - "${MAINNET_GRPC_PORT:-50051}:50051"
      - "${MAINNET_HTTP_PORT:-3000}:3000"
      - "${MAINNET_RELAY_PORT:-30031}:30031"
    command: ["daemon"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:3000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
    networks:
      - cardano-network
    deploy:
      resources:
        limits:
          memory: ${MAINNET_MEMORY_LIMIT:-4G}
        reservations:
          memory: ${MAINNET_MEMORY_RESERVATION:-2G}

  dolos-preprod:
    image: ${DOLOS_IMAGE:-ghcr.io/txpipe/dolos:latest}
    container_name: dolos-preprod
    volumes:
      - ./config/preprod:/etc/dolos:ro
      - ./data/preprod:/data
    ports:
      - "${PREPROD_GRPC_PORT:-50052}:50051"
      - "${PREPROD_HTTP_PORT:-3001}:3000"
      - "${PREPROD_RELAY_PORT:-30032}:30031"
    command: ["daemon"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:3000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
    networks:
      - cardano-network
    deploy:
      resources:
        limits:
          memory: ${PREPROD_MEMORY_LIMIT:-2G}
        reservations:
          memory: ${PREPROD_MEMORY_RESERVATION:-1G}

networks:
  cardano-network:
    driver: bridge

